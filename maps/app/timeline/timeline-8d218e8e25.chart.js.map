{"version":3,"sources":["/.tmp/app/timeline/app/timeline/timeline.chart.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","angular","module","service","TIMELINE_CONFIG","TIMELINE_COLORS","$translate","$filter","Timeline","_Koto","svg","this","_this","getPrototypeOf","configs","transitionValues","bind","isHighlighted","updateBubbles","resetBubbles","deleteBubbles","highlightGroups","updateLabel","bindLayer","colors","categoryColors","xScale","d3","scaleLinear","yScale","base","append","area","line","label","on","attrs","height","in","stdDeviation","select","parent","dx","dy","result","attr","in2","operator","x","d","id","y","y0","isStacked","stack","y1","layer","extend","dataBind","data","rows","type","reverse","selectAll","insert","selection","classed","style","values","text","events","enter:transition","t","duration","c","update","update:transition","merge","merge:transition","exit:transition","remove","n","_this2","moveGroup","left","half","anchorX","each","_","partial","that","tspans","year","formatY","bbox","node","getBBox","top","p","width","invert","event","layerY","Math","round","layerX","first","years","sort","a","b","abs","chain","map","r","row","find","hover","thru","filter","castArray","compact","groups","translate","exit","entering","enter","cx","cy","stroke","stroke-width","fill","chroma","mix","contrast","flow","rx","ry","parentNode","pathFn","_this3","uniqueId","clipRect","transition","_this4","_this5","last","hasHighligths","indexOf","_this6","ids","arguments","undefined","includes","luminance","color","desaturate","hex","_colors","scaleOrdinal","hash","_this7","isNaN","hasOwnProperty","Number","push","mean","_this8","smooth","pop","transpose","reduce","group","keys","res","instant","yearStack","begin","end","min","max","_this9","isYearVisible","rulers","x1","x2","y2","_this10","isLine","range","domain","pick","updateRulers","axisBottom","tickFormat","format","tickValues","slice","tickSize","tickPadding","axisLeft","tickSizeOuter","get","right","bottom","Koto"],"mappings":"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","file":"../../../app/timeline/timeline-8d218e8e25.chart.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nangular.module('app').service('Timeline', function (TIMELINE_CONFIG, TIMELINE_COLORS, $translate, $filter) {\n  var Timeline = function (_Koto) {\n    _inherits(Timeline, _Koto);\n\n    function Timeline(svg) {\n      _classCallCheck(this, Timeline);\n\n      // define configs\n      var _this = _possibleConstructorReturn(this, (Timeline.__proto__ || Object.getPrototypeOf(Timeline)).call(this, svg));\n\n      _this.configs = TIMELINE_CONFIG;\n\n      // Bind local method to this\n      _this.transitionValues = _this.transitionValues.bind(_this);\n      _this.isHighlighted = _this.isHighlighted.bind(_this);\n      _this.updateBubbles = _this.updateBubbles.bind(_this);\n      _this.resetBubbles = _this.resetBubbles.bind(_this);\n      _this.deleteBubbles = _this.deleteBubbles.bind(_this);\n      _this.highlightGroups = _this.highlightGroups.bind(_this);\n      _this.updateLabel = _this.updateLabel.bind(_this);\n      _this.bindLayer = _this.bindLayer.bind(_this);\n      _this.colors = _this.colors.bind(_this);\n      _this.categoryColors = _this.categoryColors.bind(_this);\n\n      // Create scale\n      _this.xScale = d3.scaleLinear();\n      _this.yScale = d3.scaleLinear();\n\n      // Create axis's layers\n      _this.base.append(\"g.axis.axis--x\");\n      _this.base.append(\"g.axis.axis--y\");\n      // Create ruler layer\n      _this.base.append('g.ruler');\n      // Create shapes layers\n      var area = _this.base.append('g.area');\n      var line = _this.base.append('g.line');\n      var label = _this.base.append('g.label');\n      // Create interaction layer\n      _this.base.append('rect.event').on('mousemove', _this.updateBubbles).on('mouseout', _this.resetBubbles);\n      // Create a bubbles layer\n      _this.base.append('g.bubble');\n\n      // Create a drop-shadow filter\n      _this.base.append('filter#dropshadow').attrs({ height: '130%' }).append('feGaussianBlur').attrs({ in: 'SourceAlpha', stdDeviation: 2 }).select(_this.parent).append('feOffset').attrs({ dx: 0, dy: 2, result: 'offsetblur' }).select(_this.parent).append('feFlood').attr('flood-opacity', 0.4).select(_this.parent).append('feComposite').attrs({ in2: \"offsetblur\", operator: \"in\" }).select(_this.parent).append('feMerge').append('feMergeNode').select(_this.parent).append('feMergeNode').attr('in', \"SourceGraphic\");\n\n      // Function to draw a line\n      _this.line = d3.line().x(function (d) {\n        return _this.xScale(d.id);\n      }).y(function (d) {\n        return _this.yScale(d.value);\n      });\n\n      // Function to draw an area\n      _this.area = d3.area().x(function (d) {\n        return _this.xScale(d.id);\n      }).y0(function (d) {\n        return _this.isStacked ? _this.yScale(d.stack[0]) : _this.height;\n      }).y1(function (d) {\n        return _this.yScale(d.value);\n      });\n\n      // Setup areas' layer\n      _this.layer('area', area, angular.extend(_this.bindLayer(_this.area), {\n        dataBind: function dataBind(data) {\n          // Disable on lines\n          var rows = data.type === 'line' ? [] : data.rows.reverse();\n          return this.selectAll('.area__group').data(rows, function (d) {\n            return d.id;\n          });\n        },\n        insert: function insert(selection) {\n          // Add the path to the current selection and clip its path the rect\n          return selection.append('path.area__group').classed('highlighted', _this.isHighlighted).style('opacity', function (d) {\n            return _this.isHighlighted(d) ? 1 : 0.3;\n          }).attr('d', function (d) {\n            return _this.area(d.values);\n          }).style('fill', _this.colors);\n        }\n      }));\n      // Setup lines' layer\n      _this.layer('line', line, angular.extend(_this.bindLayer(_this.line), {\n        dataBind: function dataBind(data) {\n          return this.selectAll('.line__group').data(data.rows, function (d) {\n            return d.id;\n          });\n        },\n        insert: function insert(selection) {\n          // Add the path to the current selection and clip its path the rect\n          return selection.append('path.line__group').classed('highlighted', _this.isHighlighted).style('opacity', function (d) {\n            return _this.isHighlighted(d) ? 1 : 0.3;\n          }).attr('d', function (d) {\n            return _this.line(d.values);\n          }).style('stroke', _this.colors);\n        }\n      }));\n      // Setup labels layer\n      _this.layer('label', label, {\n        dataBind: function dataBind(data) {\n          return this.selectAll('.label text').data(data.rows, function (d) {\n            return d.id;\n          });\n        },\n        insert: function insert(selection) {\n          return selection.append('text').text(function (d) {\n            return d.id;\n          }).classed('highlighted', _this.isHighlighted).attr(\"text-anchor\", \"end\").attr(\"dy\", '-1em').attr(\"dx\", '-1em').call(_this.updateLabel).style('opacity', 0);\n        },\n        events: {\n          'enter:transition': function enterTransition(t) {\n            return t.duration(_this.c('transition')).style('opacity', 1);\n          },\n          'update': function update(selection) {\n            return selection.classed('highlighted', _this.isHighlighted);\n          },\n          'update:transition': function updateTransition(t) {\n            return t.duration(_this.c('transition')).call(_this.updateLabel);\n          },\n          'merge': function merge(selection) {\n            return selection.classed('highlighted', _this.isHighlighted);\n          },\n          'merge:transition': function mergeTransition(t) {\n            return t.duration(_this.c('transition')).call(_this.updateLabel);\n          },\n          'exit:transition': function exitTransition(t) {\n            return t.duration(_this.c('transition')).style('opacity', 0).remove();\n          }\n        }\n      });\n      return _this;\n    }\n\n    _createClass(Timeline, [{\n      key: 'formatY',\n      value: function formatY(n) {\n        return $filter('number')(n, 0);\n      }\n    }, {\n      key: 'updateBubbles',\n      value: function updateBubbles() {\n        var _this2 = this;\n\n        // Helper function to move all groups\n        var moveGroup = function moveGroup(selection) {\n          selection.attr('transform', function (d) {\n            return 'translate(' + _this2.c('padding').left + ', ' + _this2.yScale(d.value) + ')';\n          });\n          // Move text with the right anchor\n          selection.select('text').attr('text-anchor', _this2.half < anchorX ? 'end' : 'start').each(_.partial(function insert(that) {\n            var text = d3.select(this);\n            // Remove all children from text element\n            text.selectAll(\"*\").remove();\n            // Add values on multiline\n            text.tspans(function (d) {\n              return [d.year, d.id, that.formatY(d.value)];\n            });\n            // Get size of the text box\n            var bbox = text.node().getBBox();\n            text.attrs({ y: that.c('padding').top });\n            // To add padding outside the box\n            var p = 2;\n            // Add rect as background\n            selection.select('rect').attrs({\n              x: bbox.x - p * 2,\n              y: bbox.y - p,\n              width: bbox.width + 4 * p,\n              height: bbox.height + 2 * p\n            });\n          }, _this2));\n          return selection;\n        };\n        // Get the value for this y position\n        var value = this.yScale.invert(d3.event.layerY);\n        // Year value at this for this x position\n        var y = Math.round(this.xScale.invert(d3.event.layerX));\n        // Get the closest year in the dataset\n        var year = _.first(this.data.years.sort(function (a, b) {\n          return Math.abs(y - a) - Math.abs(y - b);\n        }));\n        // Get the anchor value for this year\n        var anchorX = this.xScale(year);\n        // Simplify rows to extract only the data for the current year\n        var data = _.chain(this.data.rows).map(function (r) {\n          var row = _.find(r.values, { id: year });\n          return angular.extend(r, {\n            year: year,\n            value: row.value,\n            hover: value >= row.stack[0] && value <= row.stack[1]\n          });\n          // Then find the closest group according to y position\n        }).thru(function (rows) {\n          if (_this2.isStacked) {\n            rows = _.filter(rows, { hover: true });\n          } else {\n            rows = rows.sort(function (a, b) {\n              // Iterate over every row to find the smallest distance\n              return Math.abs(value - a.value) - Math.abs(value - b.value);\n            });\n          }\n          return rows;\n          // Return an array with only the irst value\n        }).first().castArray().compact().value();\n        // The layer that holds bubbles\n        var groups = this.base.select('.bubble')\n        // Move the layer on the right year\n        .call(this.translate(anchorX, this.c('padding').top))\n        // Create group for each row\n        .selectAll('.bubble__group')\n        // JOIN data to for the selected year\n        .data(data, function (d) {\n          return d.id;\n        });\n        // REMOVE old bubbles\n        groups.exit().remove();\n        // UPDATE current bubbles\n        groups.call(moveGroup);\n        // CREATE new bubbles\n        var entering = groups.enter().append('g').classed('bubble__group', true);\n        // Add corner points\n        entering.append('circle').attrs({\n          'cx': 0, 'cy': 0, 'r': 5,\n          'stroke': this.categoryColors,\n          'stroke-width': 5,\n          'fill': function fill(d) {\n            var c = _this2.categoryColors(d);\n            return chroma.mix(c, _this2.contrast(c));\n          }\n        });\n        // Add text label\n        entering.append('text').style('fill', _.flow(this.categoryColors, this.contrast));\n        // Add text background\n        entering.insert('rect', ':first-child').attrs({ rx: 2, ry: 2 }).style('fill', this.categoryColors);\n        entering.attr('fill', 'red').style('filter', 'url(#dropshadow)').call(moveGroup);\n        // Highlight groups\n        this.highlightGroups(_.map(data, 'id'));\n      }\n    }, {\n      key: 'resetBubbles',\n      value: function resetBubbles() {\n        // Delete all bubbles\n        this.deleteBubbles();\n        // Remove highlighted groups by passing an empty array of ids\n        this.highlightGroups();\n      }\n    }, {\n      key: 'deleteBubbles',\n      value: function deleteBubbles() {\n        this.base.selectAll('.bubble__group').remove();\n      }\n    }, {\n      key: 'parent',\n      value: function parent() {\n        return this.parentNode;\n      }\n    }, {\n      key: 'bindLayer',\n      value: function bindLayer(pathFn) {\n        var _this3 = this;\n\n        return {\n          events: {\n            enter: function enter(selection) {\n              // Create a unique id for this element clip\n              var id = _.uniqueId('rectClip-');\n              // Add the clip to the current selection\n              var clipRect = _this3.base.append(\"clipPath\").attr(\"id\", id).append(\"rect\");\n              // Clip path to the current selection\n              selection.attr('clip-path', 'url(#' + id + ')');\n              // Apply the transition on the clip's rect\n              clipRect.attrs({ width: 0, height: _this3.height }).transition().duration(_this3.c('transition')).attr('width', _this3.width)\n              // After the transition ends\n              .on(\"end\", function end() {\n                // Remove the clip-path from the selection\n                selection.attr('clip-path', null);\n                // And remove its holding element\n                d3.select(this.parentNode).remove();\n              });\n            },\n            merge: this.transitionValues(pathFn),\n            update: this.transitionValues(pathFn),\n            exit: function exit(selection) {\n              selection.transition().duration(_this3.c('transition')).style('opacity', 0).on('end', function () {\n                return selection.remove();\n              });\n            }\n          }\n        };\n      }\n    }, {\n      key: 'transitionValues',\n      value: function transitionValues(pathFn) {\n        var _this4 = this;\n\n        return function (selection) {\n          selection.transition().duration(_this4.c('transition')).style('opacity', function (d) {\n            return _this4.isHighlighted(d) ? 1 : 0.3;\n          }).attr(\"d\", function (d) {\n            return pathFn(d.values);\n          });\n        };\n      }\n    }, {\n      key: 'updateLabel',\n      value: function updateLabel(selection) {\n        var _this5 = this;\n\n        return selection.attr(\"x\", function (d) {\n          return _this5.xScale(_.last(d.values).id);\n        }).attr(\"y\", function (d) {\n          var row = _.last(d.values);\n          return _this5.yScale(row.value);\n        });\n      }\n    }, {\n      key: 'isHighlighted',\n      value: function isHighlighted(d) {\n        return !this.hasHighligths || this.c('highlights').indexOf(d.id) > -1;\n      }\n    }, {\n      key: 'highlightGroups',\n      value: function highlightGroups() {\n        var _this6 = this;\n\n        var ids = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n        // True if the given set of ids includes the selection\n        var includes = function includes(d) {\n          return ids.indexOf(d.id) > -1;\n        };\n        // Change opacity and stroke accordingly\n        this.base.selectAll('.line__group,.area__group').style('opacity', function (d) {\n          return includes(d) || _this6.isHighlighted(d) ? 1 : 0.3;\n        });\n        this.base.selectAll('.line__group').style('stroke', function (d) {\n          return includes(d) ? _this6.categoryColors(d) : _this6.colors(d);\n        });\n        this.base.selectAll('.area__group').style('fill', function (d) {\n          return includes(d) ? _this6.categoryColors(d) : _this6.colors(d);\n        });\n      }\n    }, {\n      key: 'contrast',\n      value: function contrast(c) {\n        return chroma(c).luminance() > 0.5 ? 'black' : 'white';\n      }\n    }, {\n      key: 'colors',\n      value: function colors(d) {\n        // return a different color if the element is not highlighted\n        var color = this.categoryColors(d);\n        // return a different color if the element is not highlighted\n        return this.isHighlighted(d) ? color : chroma(color).desaturate(1).hex();\n      }\n    }, {\n      key: 'categoryColors',\n      value: function categoryColors(d) {\n        // Create color schema if undefined\n        if (!this._colors) {\n          this._colors = d3.scaleOrdinal(TIMELINE_COLORS);\n        }\n        return this._colors(d.id);\n      }\n    }, {\n      key: 'smooth',\n      value: function smooth(hash) {\n        var _this7 = this;\n\n        // Iterate over the hash\n        _.each(hash, function (value, key) {\n          // Skip non-numeric keys and the first year\n          if (!isNaN(key) && hash.hasOwnProperty(Number(key) - 1)) {\n            // Every values to use in the moving average\n            var values = [];\n            // Go backward and forward the current year\n            for (var i = -_this7.c('smoothing'); i <= _this7.c('smoothing'); i++) {\n              // Build the hash key to the year\n              var year = Number(key) + i;\n              // Since the mean function ignore undefined element, we do not check\n              // that there is a value for the year!\n              values.push(hash[year]);\n            }\n            // Calculate the mean for all values\n            hash[key] = d3.mean(values);\n          }\n        });\n        return hash;\n      }\n    }, {\n      key: 'transform',\n      value: function transform(data) {\n        var _this8 = this;\n\n        // Extract years from the first line\n        var years = this.years(data[0]);\n        // Smooth all the rows\n        data = data.map(this.smooth.bind(this));\n        // Get groups of data\n        var groups = _.chain(data).map(function (r) {\n          return _.values(r).pop();\n        }).value();\n        // Transpose data to be able to stack them\n        var transpose = _.map(years, function (year) {\n          return angular.extend({ year: year }, _.reduce(groups, function (hash, group, i) {\n            hash[group] = data[i][year];\n            return hash;\n          }, {}));\n        });\n        // Stack data for stacked representation\n        var stack = d3.stack().keys(groups)(transpose);\n        // Create an object for each group\n        var rows = _.reduce(data, function (res, hash, i) {\n          // Create a new object as row, describing this group\n          res.push({\n            // The last element of this hash is the group id\n            id: $translate.instant('timeline.labels.' + hash.label),\n            // Collect value for each year\n            values: _.map(years, function (year) {\n              // Create a stack for this year\n              var yearStack = _.find(stack[i], function (d) {\n                return d.data.year === year;\n              });\n              // Returns a hash\n              return {\n                id: year,\n                stack: yearStack,\n                value: _this8.isStacked ? yearStack[1] : hash[year]\n              };\n            })\n          });\n          return res;\n        }, []);\n        // Return an object with several precalculated fields\n        return {\n          years: years, rows: rows, stack: stack,\n          // Save the type of the chart for nested access\n          type: this.c('type'),\n          // First year in this dataset\n          begin: years[0],\n          // Last year in this dataset\n          end: years[years.length - 1],\n          // Minimum value among all row\n          min: d3.min(rows, function (c) {\n            return d3.min(c.values, function (d) {\n              return _this8.isStacked ? d.stack[0] : d.value;\n            });\n          }),\n          // Maximum value among all row\n          max: d3.max(rows, function (c) {\n            return d3.max(c.values, function (d) {\n              return d.value;\n            });\n          })\n        };\n      }\n    }, {\n      key: 'years',\n      value: function years(hash) {\n        // Extract year from a given object\n        return _.chain(hash).keys().remove(function (y) {\n          return !isNaN(y);\n        }).map(function (y) {\n          return Number(y);\n        }).sort().value();\n      }\n    }, {\n      key: 'translate',\n      value: function translate() {\n        var left = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n        var top = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n        return function (selection) {\n          return selection.attr('transform', 'translate(' + left + ', ' + top + ')');\n        };\n      }\n    }, {\n      key: 'isYearVisible',\n      value: function isYearVisible(year) {\n        // Year must strictly in bounds\n        return year >= this.data.begin && year < this.data.end;\n      }\n    }, {\n      key: 'updateRulers',\n      value: function updateRulers() {\n        var _this9 = this;\n\n        var t = d3.transition().duration(this.c('transition'));\n        var moveGroup = function moveGroup(selection) {\n          return selection.attr('transform', function (d) {\n            var left = _this9.c('padding').left + _this9.xScale(d[0]);\n            var top = _this9.c('padding').top;\n            return 'translate(' + left + ', ' + top + ')';\n          });\n        };\n        var data = this.c('rulers');\n        // Reove rulers that are under 0\n        data = data.filter(function (d) {\n          return _this9.isYearVisible(d[0]);\n        });\n        // JOIN new data to rulers\n        var rulers = this.base.select('.ruler').selectAll('.ruler__group').data(data, function (d) {\n          return d[0];\n        });\n        // REMOVE old rulers\n        rulers.exit().transition(t).style(\"opacity\", 0).remove();\n        // UPDATE old rulers\n        rulers.transition(t).call(moveGroup).style('opacity', 1);\n        rulers.selectAll('line').transition(t).attr('y2', this.height);\n        // CREATE new rulers\n        var groups = rulers.enter().append('g').classed('ruler__group', true);\n        // Move the new ruler to the right position\n        groups.call(moveGroup).style('opacity', 0).transition(t).style('opacity', 1);\n        groups.append('line').attrs({ x1: 0, y1: 0, x2: 0, y2: this.height });\n        groups.append('text').text(function (d) {\n          return d[1];\n        }).attrs({ dy: '.85em', dx: '1em' });\n      }\n    }, {\n      key: 'preDraw',\n      value: function preDraw(data) {\n        var _this10 = this;\n\n        var p = this.c('padding');\n        var min = this.c('min');\n        var max = this.c('max');\n        // Fixed minimum value\n        if (min === null) {\n          min = this.isLine ? Math.max(data.min - (data.max - data.min) * 1 / 8, 0) : data.min;\n        }\n        // Fixed maximum value\n        if (max === null) {\n          max = data.max + (data.max - data.min) * 1 / 8;\n        }\n        // Save the data before the chart is rendered\n        this.data = data;\n        // Set xScale according to the size of the container and the last year\n        this.xScale.range([0, this.width]).domain([data.begin, data.end]);\n        this.yScale.range([this.height, 0]).domain([min, max]);\n        // Set sizes explicitely\n        this.base.attr(_.pick(this, ['width', 'height']));\n        this.base.classed('timeline__chart--highlights', this.hasHighligths);\n        this.base.selectAll('.line, .area, .event, .label').call(this.translate(p.left, p.top));\n        // Update rulers according to the new scales\n        this.updateRulers();\n        // Remove existing bubble\n        this.deleteBubbles();\n        // Resize interaction layer\n        this.base.select('.event').attrs(_.pick(this, ['width', 'height'])).call(this.translate(p.left, p.top));\n        // Select the existing X axis to update it\n        this.base.select('.axis--x').call(this.translate(p.left, this.height + p.top))\n        // Animate the axis creation/update\n        .transition().duration(this.c('transition')).call(d3.axisBottom(this.xScale).tickFormat(d3.format('')).tickValues(data.years.slice(1, -1)).tickSize(0).tickPadding(10));\n        // Select the existing Y axis to update it\n        this.base.select('.axis--y').call(this.translate(p.left, p.top))\n        // Animate the axis creation/update\n        .transition().duration(this.c('transition')).call(d3.axisLeft(this.yScale).tickSizeOuter(0).tickFormat(this.formatY).tickSize(-this.width))\n        // After the transition ends\n        .on(\"end\", function () {\n          // Add unit  to the last child\n          _this10.base.select('.axis--y .tick:last-child text').text(function (d) {\n            return _this10.formatY(d) + ' ' + (_this10.c('yunit') || '');\n          });\n        });\n        // Changed text alignment on y axis\n        this.base.selectAll('.axis--y text').attr(\"y\", 2).attr(\"x\", 0).attr(\"dx\", \"4px\").attr(\"dy\", \"-1em\").style(\"text-anchor\", \"start\");\n      }\n    }, {\n      key: 'width',\n      get: function get() {\n        return this.c('width') - this.c('padding').left - this.c('padding').right;\n      }\n    }, {\n      key: 'height',\n      get: function get() {\n        return this.c('height') - this.c('padding').top - this.c('padding').bottom;\n      }\n    }, {\n      key: 'half',\n      get: function get() {\n        return this.width / 2;\n      }\n    }, {\n      key: 'isStacked',\n      get: function get() {\n        return this.c('type') === 'stacked-area';\n      }\n    }, {\n      key: 'isLine',\n      get: function get() {\n        return this.c('type') === 'line';\n      }\n    }, {\n      key: 'isArea',\n      get: function get() {\n        return this.c('type') === 'area';\n      }\n    }, {\n      key: 'hasHighligths',\n      get: function get() {\n        return this.c('highlights').length > 0;\n      }\n    }]);\n\n    return Timeline;\n  }(Koto);\n\n  return Timeline;\n});"]}